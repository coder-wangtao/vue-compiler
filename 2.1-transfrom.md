transform 函数内具体是如何处理 vue 内置的 v-for、v-model 等指令的？

transform 函数内主要有两部分。
1.createTransformContext：传入模版 AST 抽象语法树和 options，调用 createTransformContext 函数生成 context 上下文对象。
2.traverseNode：传入模版 AST 抽象语法树和 context 上下文对象，调用 traverseNode 函数对树中的 node 节点进行转换。

3.traverseNode:
3.1traverseNode 函数是一个典型的洋葱模型。第一次执行 traverseNode 函数的时候会进入洋葱模型的第一层，先将 nodeTransforms 数组中的转换函数全部执行一遍，对第一层的 node 节点进行第一次转换，将转换函数返回的回调函数存到第一层的 exitFns 数组中。经过第一次转换后 v-for 等指令已经被初次处理了。

3.2 然后执行 traverseChildren 函数，在 traverseChildren 函数中对当前 node 节点的子节点执行 traverseNode 函数。此时就会进入洋葱模型的第二层，和上一步一样会将 nodeTransforms 数组中的转换函数全部执行一遍，对第二层的 node 节点进行第一次转换，将转换函数返回的回调函数存到第二层的 exitFns 数组中。

3.3 假如第二层的 node 节点已经没有了子节点，洋葱模型就会从“进入阶段”变成“出去阶段”。将第二层的 exitFns 数组中存的回调函数全部执行一遍，对 node 节点进行第二次转换，然后出去到第一层的洋葱模型。经过第二次转换后 v-for 等指令已经被完全处理了。

3.4 同样将第一层中的 exitFns 数组中存的回调函数全部执行一遍，由于此时第二层的 node 节点已经全部处理完了，所以在 exitFns 数组中存的回调函数中就可以根据子节点的情况来处理父节点。

3.5 执行 nodeTransforms 数组中的 transformElement 转换函数，会返回一个回调函数。在回调函数中会调用 buildProps 函数，在 buildProps 函数中只有当 node 节点中有对应的指令才会执行 directiveTransforms 对象中对应的转换函数。比如当前 node 节点有 v-model 指令，才会去执行 transformModel 转换函数。v-model 等指令也就被处理了。(相当于 v-model 是在“出去阶段”处理的)

v-for：v-for 指令的 transformFor 转换函数是在 nodeTransforms 数组中。每次处理 node 节点都会执行。
//会有两次转换
调用 transformFor 转换函数，第 1 次对 node 节点进行转换之后。
调用 transformFor 转换函数返回的回调函数，第 2 次对 node 节点进行转换之后。

v-model：transformModel 转换函数是在 directiveTransforms 对象中，只有当 node 节点中有对应的指令才会执行对应的转换函数。

在进入时会按照顺序去执行 nodeTransforms 数组中的转换函数。在退出时会倒序去执行存下来的回调函数，比如在 nodeTransforms 数组中 transformIf 函数排在 transformFor 函数前面。transformIf 用于处理 v-if 指令，transformFor 用于处理 v-for 指令。在进入时 transformIf 函数会比 transformFor 函数先执行，所以在组件上面同时使用 v-if 和 v-for 指令，会是 v-if 指令先生效。在退出阶段时 transformIf 函数会比 transformFor 函数后执行，所以在 transformIf 回调函数中可以根据 transformFor 回调函数的执行结果来决定如何处理当前的 node 节点。
