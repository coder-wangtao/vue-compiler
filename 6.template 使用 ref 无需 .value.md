<template>
  <p>{{ msg }}</p>
  <button @click="msg = 'Hello Vue3'">change msg</button>
</template>

<script setup lang="ts">
import { ref } from "vue";
const msg = ref("Hello World");
console.log(msg.value);
</script>

//编译后

<!--
import {
  Fragment as _Fragment,
  createElementBlock as _createElementBlock,
  createElementVNode as _createElementVNode,
  defineComponent as _defineComponent,
  openBlock as _openBlock,
  toDisplayString as _toDisplayString,
  ref,
} from "/node_modules/.vite/deps/vue.js?v=23bfe016";

const _sfc_main = _defineComponent({
  __name: "index",
  setup() {
    const msg = ref("Hello World");
    console.log(msg.value);
    const __returned__ = { msg };
    return __returned__;
  },
});

function _sfc_render(_ctx, _cache, $props, $setup, $data, $options) {
  return (
    _openBlock(),
    _createElementBlock(
      _Fragment,
      null,
      [
        _createElementVNode("p", null, _toDisplayString($setup.msg), 1),
        _createElementVNode(
          "button",
          {
            onClick:
              _cache[0] ||
              (_cache[0] = ($event) => ($setup.msg = "Hello Vue3")),
          },
          "change msg"
        ),
      ],
      64
    )
  );
}
_sfc_main.render = _sfc_render;
export default _sfc_main; -->

1.我们写的 vue 代码

<script setup lang="ts">
import { ref } from "vue";
const msg = ref("Hello World");
console.log(msg.value);
</script>
<!--
2.经过编译后生成setup方法
3.vue内部执行setup方法
4.setup返回值，得到setupResult对象 {msg}
5.执行handleSetupResult(instance,setupResult)
6.将proxy代理后的setupResult(setup返回值对象)赋值给instance.setupState
-->

<!--
7.render函数中读取ref ($setup.msg)
8.就是在读取instance.setupState.msg
9.instance.setupState是一个proxy代理后的setup返回值对象
10.在proxy中的get拦截中会自动去取msg变量的.value属性
-->

<!--
7.render函数中对ref变量进行赋值 $setup.msg = "hello world"
8.就是在给instance.setupState.msg赋值
9.instance.setupState是一个proxy代理后的setup返回值对象
10.在proxy中的set拦截中会自动去给msg变量的.value属性进行赋值
-->

proxyRefs:vue 源码用的它
在 vue3 的 template 中使用 ref 变量无需使用.value，是因为有个 Proxy 的 get 拦截，在 get 拦截中会自动帮我们去取 ref 变量的.value 属性。
同样的在 template 中对 ref 变量进行赋值也无需使用.value，也是有个 Proxy 的 set 拦截，在 set 拦截中会自动帮我们去给 ref 变量的.value 属性进行赋值。
